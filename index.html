1â†’<!DOCTYPE html>
     2â†’<html lang="en">
     3â†’<head>
     4â†’    <meta charset="UTF-8">
     5â†’    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     6â†’    <title>PDF File Separator - FINAL VERSION</title>
     7â†’    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
     8â†’    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
     9â†’    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    10â†’    <style>
    11â†’        * {
    12â†’            margin: 0;
    13â†’            padding: 0;
    14â†’            box-sizing: border-box;
    15â†’        }
    16â†’
    17â†’        body {
    18â†’            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    19â†’            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    20â†’            min-height: 100vh;
    21â†’            padding: 20px;
    22â†’        }
    23â†’
    24â†’        .container {
    25â†’            max-width: 1400px;
    26â†’            margin: 0 auto;
    27â†’            background: white;
    28â†’            border-radius: 16px;
    29â†’            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    30â†’            overflow: hidden;
    31â†’        }
    32â†’
    33â†’        .header {
    34â†’            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    35â†’            color: white;
    36â†’            padding: 30px;
    37â†’            text-align: center;
    38â†’        }
    39â†’
    40â†’        .header h1 {
    41â†’            font-size: 2.5em;
    42â†’            margin-bottom: 10px;
    43â†’        }
    44â†’
    45â†’        .header p {
    46â†’            font-size: 1.1em;
    47â†’            opacity: 0.9;
    48â†’        }
    49â†’
    50â†’        .upload-section {
    51â†’            padding: 40px;
    52â†’            text-align: center;
    53â†’            border-bottom: 2px solid #f0f0f0;
    54â†’        }
    55â†’
    56â†’        .upload-area {
    57â†’            border: 3px dashed #667eea;
    58â†’            border-radius: 12px;
    59â†’            padding: 60px 40px;
    60â†’            background: #f8f9ff;
    61â†’            cursor: pointer;
    62â†’            transition: all 0.3s ease;
    63â†’        }
    64â†’
    65â†’        .upload-area:hover {
    66â†’            background: #f0f2ff;
    67â†’            border-color: #764ba2;
    68â†’        }
    69â†’
    70â†’        .upload-area.dragover {
    71â†’            background: #e8ebff;
    72â†’            border-color: #764ba2;
    73â†’            transform: scale(1.02);
    74â†’        }
    75â†’
    76â†’        .upload-icon {
    77â†’            font-size: 4em;
    78â†’            margin-bottom: 20px;
    79â†’        }
    80â†’
    81â†’        .upload-text {
    82â†’            font-size: 1.3em;
    83â†’            color: #667eea;
    84â†’            margin-bottom: 10px;
    85â†’            font-weight: 600;
    86â†’        }
    87â†’
    88â†’        .upload-subtext {
    89â†’            color: #666;
    90â†’            font-size: 0.95em;
    91â†’        }
    92â†’
    93â†’        #fileInput {
    94â†’            display: none;
    95â†’        }
    96â†’
    97â†’        .btn {
    98â†’            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    99â†’            color: white;
   100â†’            border: none;
   101â†’            padding: 14px 32px;
   102â†’            border-radius: 8px;
   103â†’            font-size: 1.1em;
   104â†’            cursor: pointer;
   105â†’            transition: all 0.3s ease;
   106â†’            font-weight: 600;
   107â†’            margin: 10px 5px;
   108â†’        }
   109â†’
   110â†’        .btn:hover {
   111â†’            transform: translateY(-2px);
   112â†’            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
   113â†’        }
   114â†’
   115â†’        .btn:disabled {
   116â†’            opacity: 0.5;
   117â†’            cursor: not-allowed;
   118â†’            transform: none;
   119â†’        }
   120â†’
   121â†’        .btn-success {
   122â†’            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
   123â†’        }
   124â†’
   125â†’        .btn-success:hover {
   126â†’            box-shadow: 0 8px 20px rgba(56, 239, 125, 0.4);
   127â†’        }
   128â†’
   129â†’        .pages-section {
   130â†’            padding: 40px;
   131â†’            display: none;
   132â†’        }
   133â†’
   134â†’        .pages-section.active {
   135â†’            display: block;
   136â†’        }
   137â†’
   138â†’        .controls {
   139â†’            display: flex;
   140â†’            justify-content: space-between;
   141â†’            align-items: center;
   142â†’            margin-bottom: 30px;
   143â†’            flex-wrap: wrap;
   144â†’            gap: 15px;
   145â†’        }
   146â†’
   147â†’        .controls h2 {
   148â†’            color: #333;
   149â†’            font-size: 1.8em;
   150â†’        }
   151â†’
   152â†’        .pages-grid {
   153â†’            display: grid;
   154â†’            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
   155â†’            gap: 25px;
   156â†’            margin-bottom: 30px;
   157â†’        }
   158â†’
   159â†’        .page-card {
   160â†’            background: white;
   161â†’            border: 2px solid #e0e0e0;
   162â†’            border-radius: 12px;
   163â†’            padding: 20px;
   164â†’            transition: all 0.3s ease;
   165â†’            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
   166â†’        }
   167â†’
   168â†’        .page-card:hover {
   169â†’            transform: translateY(-5px);
   170â†’            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
   171â†’            border-color: #667eea;
   172â†’        }
   173â†’
   174â†’        .page-number {
   175â†’            font-weight: 700;
   176â†’            color: #667eea;
   177â†’            margin-bottom: 15px;
   178â†’            font-size: 1.1em;
   179â†’        }
   180â†’
   181â†’        .page-preview {
   182â†’            width: 100%;
   183â†’            border: 1px solid #ddd;
   184â†’            border-radius: 8px;
   185â†’            margin-bottom: 15px;
   186â†’            background: #f9f9f9;
   187â†’            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
   188â†’        }
   189â†’
   190â†’        .category-select {
   191â†’            width: 100%;
   192â†’            padding: 12px;
   193â†’            border: 2px solid #e0e0e0;
   194â†’            border-radius: 8px;
   195â†’            font-size: 1em;
   196â†’            background: white;
   197â†’            cursor: pointer;
   198â†’            transition: all 0.3s ease;
   199â†’        }
   200â†’
   201â†’        .category-select:focus {
   202â†’            outline: none;
   203â†’            border-color: #667eea;
   204â†’            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
   205â†’        }
   206â†’
   207â†’        .loading {
   208â†’            text-align: center;
   209â†’            padding: 40px;
   210â†’            color: #667eea;
   211â†’            font-size: 1.2em;
   212â†’        }
   213â†’
   214â†’        .spinner {
   215â†’            border: 4px solid #f3f3f3;
   216â†’            border-top: 4px solid #667eea;
   217â†’            border-radius: 50%;
   218â†’            width: 50px;
   219â†’            height: 50px;
   220â†’            animation: spin 1s linear infinite;
   221â†’            margin: 20px auto;
   222â†’        }
   223â†’
   224â†’        @keyframes spin {
   225â†’            0% { transform: rotate(0deg); }
   226â†’            100% { transform: rotate(360deg); }
   227â†’        }
   228â†’
   229â†’        .action-buttons {
   230â†’            display: flex;
   231â†’            gap: 15px;
   232â†’            flex-wrap: wrap;
   233â†’            justify-content: center;
   234â†’        }
   235â†’
   236â†’        .success-message {
   237â†’            background: #d4edda;
   238â†’            border: 1px solid #c3e6cb;
   239â†’            color: #155724;
   240â†’            padding: 15px 20px;
   241â†’            border-radius: 8px;
   242â†’            margin: 20px 0;
   243â†’            text-align: center;
   244â†’            font-weight: 600;
   245â†’        }
   246â†’
   247â†’        .error-message {
   248â†’            background: #f8d7da;
   249â†’            border: 1px solid #f5c6cb;
   250â†’            color: #721c24;
   251â†’            padding: 15px 20px;
   252â†’            border-radius: 8px;
   253â†’            margin: 20px 0;
   254â†’            text-align: center;
   255â†’            font-weight: 600;
   256â†’        }
   257â†’
   258â†’        @media (max-width: 768px) {
   259â†’            .header h1 {
   260â†’                font-size: 1.8em;
   261â†’            }
   262â†’
   263â†’            .pages-grid {
   264â†’                grid-template-columns: 1fr;
   265â†’            }
   266â†’
   267â†’            .controls {
   268â†’                flex-direction: column;
   269â†’                align-items: stretch;
   270â†’            }
   271â†’        }
   272â†’    </style>
   273â†’</head>
   274â†’<body>
   275â†’    <div class="container">
   276â†’        <div class="header">
   277â†’            <h1>ðŸ“„ PDF File Separator</h1>
   278â†’            <p>Upload, categorize, and organize your PDF documents with ease</p>
   279â†’        </div>
   280â†’
   281â†’        <div class="upload-section" id="uploadSection">
   282â†’            <div class="upload-area" id="uploadArea">
   283â†’                <div class="upload-icon">ðŸ“¤</div>
   284â†’                <div class="upload-text">Click to upload or drag & drop your PDF file</div>
   285â†’                <div class="upload-subtext">Supports PDF files up to 50MB</div>
   286â†’            </div>
   287â†’            <input type="file" id="fileInput" accept=".pdf">
   288â†’        </div>
   289â†’
   290â†’        <div class="pages-section" id="pagesSection">
   291â†’            <div class="controls">
   292â†’                <h2>Categorize Your Documents</h2>
   293â†’                <button class="btn" onclick="resetApp()">Upload New File</button>
   294â†’            </div>
   295â†’            <div id="loading" class="loading" style="display: none;">
   296â†’                <div class="spinner"></div>
   297â†’                Processing your PDF...
   298â†’            </div>
   299â†’            <div class="pages-grid" id="pagesGrid"></div>
   300â†’            <div class="action-buttons">
   301â†’                <button class="btn btn-success" onclick="downloadSeparatedPDFs()" id="downloadBtn">
   302â†’                    Download All PDFs (ZIP)
   303â†’                </button>
   304â†’            </div>
   305â†’            <div id="messageContainer"></div>
   306â†’        </div>
   307â†’    </div>
   308â†’
   309â†’    <script>
   310â†’        console.log('=== PDF Separator FINAL VERSION ===');
   311â†’        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
   312â†’
   313â†’        // Store the original file as a Blob - Blobs persist!
   314â†’        let originalFileBlob = null;
   315â†’        let pdfDoc = null;
   316â†’        const pageCategories = {};
   317â†’
   318â†’        const categories = [
   319â†’            { value: '', label: 'Select Category' },
   320â†’            { value: 'police-report', label: 'Police Report' },
   321â†’            { value: 'vehicle-reg', label: 'Vehicle Registration' },
   322â†’            { value: 'driver-license', label: 'Driver License' },
   323â†’            { value: 'civil-id', label: 'Civil ID' },
   324â†’            { value: 'incident-report', label: 'Incident Report' },
   325â†’            { value: 'garage-estimation', label: 'Garage Estimation' },
   326â†’            { value: 'insurance-policy', label: 'Insurance Policy' },
   327â†’            { value: 'other', label: 'Other' }
   328â†’        ];
   329â†’
   330â†’        const uploadArea = document.getElementById('uploadArea');
   331â†’        const fileInput = document.getElementById('fileInput');
   332â†’
   333â†’        uploadArea.addEventListener('click', () => fileInput.click());
   334â†’
   335â†’        uploadArea.addEventListener('dragover', (e) => {
   336â†’            e.preventDefault();
   337â†’            uploadArea.classList.add('dragover');
   338â†’        });
   339â†’
   340â†’        uploadArea.addEventListener('dragleave', () => {
   341â†’            uploadArea.classList.remove('dragover');
   342â†’        });
   343â†’
   344â†’        uploadArea.addEventListener('drop', (e) => {
   345â†’            e.preventDefault();
   346â†’            uploadArea.classList.remove('dragover');
   347â†’            const file = e.dataTransfer.files[0];
   348â†’            if (file && file.type === 'application/pdf') {
   349â†’                handleFileUpload(file);
   350â†’            } else {
   351â†’                showMessage('Please upload a valid PDF file', 'error');
   352â†’            }
   353â†’        });
   354â†’
   355â†’        fileInput.addEventListener('change', (e) => {
   356â†’            const file = e.target.files[0];
   357â†’            if (file) {
   358â†’                handleFileUpload(file);
   359â†’            }
   360â†’        });
   361â†’
   362â†’        async function handleFileUpload(file) {
   363â†’            console.log('File selected:', file.name, 'Size:', file.size);
   364â†’            document.getElementById('loading').style.display = 'block';
   365â†’            document.getElementById('pagesGrid').innerHTML = '';
   366â†’
   367â†’            // Store the file as a Blob directly - no ArrayBuffer conversion!
   368â†’            originalFileBlob = file;
   369â†’            console.log('âœ“ File stored as Blob');
   370â†’
   371â†’            // Read it for preview
   372â†’            const arrayBuffer = await file.arrayBuffer();
   373â†’            const uint8Array = new Uint8Array(arrayBuffer);
   374â†’            console.log('âœ“ Created Uint8Array for preview, size:', uint8Array.length);
   375â†’
   376â†’            await loadPDF(uint8Array);
   377â†’        }
   378â†’
   379â†’        async function loadPDF(bytes) {
   380â†’            try {
   381â†’                pdfDoc = await pdfjsLib.getDocument({ data: bytes }).promise;
   382â†’                console.log('âœ“ PDF loaded, pages:', pdfDoc.numPages);
   383â†’                await renderPages();
   384â†’                document.getElementById('uploadSection').style.display = 'none';
   385â†’                document.getElementById('pagesSection').classList.add('active');
   386â†’                document.getElementById('loading').style.display = 'none';
   387â†’            } catch (error) {
   388â†’                console.error('Error loading PDF:', error);
   389â†’                showMessage('Error loading PDF. Please try again.', 'error');
   390â†’                document.getElementById('loading').style.display = 'none';
   391â†’            }
   392â†’        }
   393â†’
   394â†’        async function renderPages() {
   395â†’            const grid = document.getElementById('pagesGrid');
   396â†’            grid.innerHTML = '';
   397â†’
   398â†’            for (let i = 1; i <= pdfDoc.numPages; i++) {
   399â†’                const page = await pdfDoc.getPage(i);
   400â†’                const viewport = page.getViewport({ scale: 0.5 });
   401â†’
   402â†’                const canvas = document.createElement('canvas');
   403â†’                const context = canvas.getContext('2d');
   404â†’                canvas.width = viewport.width;
   405â†’                canvas.height = viewport.height;
   406â†’
   407â†’                await page.render({
   408â†’                    canvasContext: context,
   409â†’                    viewport: viewport
   410â†’                }).promise;
   411â†’
   412â†’                const card = document.createElement('div');
   413â†’                card.className = 'page-card';
   414â†’                card.innerHTML = `
   415â†’                    <div class="page-number">Page ${i}</div>
   416â†’                    <img src="${canvas.toDataURL()}" class="page-preview" alt="Page ${i}">
   417â†’                    <select class="category-select" data-page="${i}">
   418â†’                        ${categories.map(cat => `<option value="${cat.value}">${cat.label}</option>`).join('')}
   419â†’                    </select>
   420â†’                `;
   421â†’
   422â†’                card.querySelector('select').addEventListener('change', (e) => {
   423â†’                    pageCategories[i] = e.target.value;
   424â†’                    console.log('Page', i, 'categorized as:', e.target.value);
   425â†’                });
   426â†’
   427â†’                grid.appendChild(card);
   428â†’            }
   429â†’            console.log('âœ“ All pages rendered');
   430â†’        }
   431â†’
   432â†’        async function downloadSeparatedPDFs() {
   433â†’            console.log('=== DOWNLOAD STARTED ===');
   434â†’
   435â†’            const categorizedPages = {};
   436â†’
   437â†’            // Group pages by category
   438â†’            for (let [page, category] of Object.entries(pageCategories)) {
   439â†’                if (category && category !== '') {
   440â†’                    if (!categorizedPages[category]) {
   441â†’                        categorizedPages[category] = [];
   442â†’                    }
   443â†’                    categorizedPages[category].push(parseInt(page));
   444â†’                }
   445â†’            }
   446â†’
   447â†’            console.log('Categorized pages:', categorizedPages);
   448â†’
   449â†’            if (Object.keys(categorizedPages).length === 0) {
   450â†’                showMessage('Please select at least one category for your pages', 'error');
   451â†’                return;
   452â†’            }
   453â†’
   454â†’            document.getElementById('loading').style.display = 'block';
   455â†’
   456â†’            try {
   457â†’                if (!originalFileBlob) {
   458â†’                    throw new Error('Original file not found. Please re-upload.');
   459â†’                }
   460â†’
   461â†’                console.log('âœ“ Original file blob exists, size:', originalFileBlob.size);
   462â†’
   463â†’                // Convert Blob to ArrayBuffer fresh each time
   464â†’                const arrayBuffer = await originalFileBlob.arrayBuffer();
   465â†’                console.log('âœ“ Converted to ArrayBuffer, size:', arrayBuffer.byteLength);
   466â†’
   467â†’                const { PDFDocument } = PDFLib;
   468â†’                const originalPdf = await PDFDocument.load(arrayBuffer);
   469â†’                console.log('âœ“ PDF loaded with pdf-lib, pages:', originalPdf.getPageCount());
   470â†’
   471â†’                // Create a ZIP file to store all categorized PDFs
   472â†’                const zip = new JSZip();
   473â†’
   474â†’                for (let [category, pages] of Object.entries(categorizedPages)) {
   475â†’                    console.log('Processing category:', category);
   476â†’                    const newPdf = await PDFDocument.create();
   477â†’
   478â†’                    pages.sort((a, b) => a - b);
   479â†’
   480â†’                    for (let pageNum of pages) {
   481â†’                        const [copiedPage] = await newPdf.copyPages(originalPdf, [pageNum - 1]);
   482â†’                        newPdf.addPage(copiedPage);
   483â†’                    }
   484â†’
   485â†’                    const pdfBytes = await newPdf.save();
   486â†’                    console.log('âœ“ Created PDF for', category, 'size:', pdfBytes.length);
   487â†’
   488â†’                    const categoryLabel = categories.find(c => c.value === category)?.label || category;
   489â†’                    const fileName = `${categoryLabel.replace(/\s+/g, '_')}.pdf`;
   490â†’
   491â†’                    // Add this PDF to the ZIP
   492â†’                    zip.file(fileName, pdfBytes);
   493â†’                }
   494â†’
   495â†’                console.log('âœ“ Generating ZIP file...');
   496â†’                const zipBlob = await zip.generateAsync({ type: 'blob' });
   497â†’                console.log('âœ“ ZIP created, size:', zipBlob.size);
   498â†’
   499â†’                const url = URL.createObjectURL(zipBlob);
   500â†’                const link = document.createElement('a');
   501â†’                link.href = url;
   502â†’                link.download = 'Categorized_Documents.zip';
   503â†’                document.body.appendChild(link);
   504â†’                link.click();
   505â†’                document.body.removeChild(link);
   506â†’
   507â†’                setTimeout(() => URL.revokeObjectURL(url), 100);
   508â†’
   509â†’                document.getElementById('loading').style.display = 'none';
   510â†’                showMessage(`âœ“ Successfully created ZIP with ${Object.keys(categorizedPages).length} PDF files!`, 'success');
   511â†’                console.log('=== DOWNLOAD COMPLETE ===');
   512â†’            } catch (error) {
   513â†’                console.error('ERROR:', error);
   514â†’                console.error('Stack:', error.stack);
   515â†’                document.getElementById('loading').style.display = 'none';
   516â†’                showMessage(`Error: ${error.message}`, 'error');
   517â†’            }
   518â†’        }
   519â†’
   520â†’        function showMessage(message, type) {
   521â†’            const container = document.getElementById('messageContainer');
   522â†’            const className = type === 'error' ? 'error-message' : 'success-message';
   523â†’            container.innerHTML = `<div class="${className}">${message}</div>`;
   524â†’            setTimeout(() => {
   525â†’                container.innerHTML = '';
   526â†’            }, 5000);
   527â†’        }
   528â†’
   529â†’        function resetApp() {
   530â†’            originalFileBlob = null;
   531â†’            pdfDoc = null;
   532â†’            Object.keys(pageCategories).forEach(key => delete pageCategories[key]);
   533â†’            document.getElementById('pagesSection').classList.remove('active');
   534â†’            document.getElementById('uploadSection').style.display = 'block';
   535â†’            document.getElementById('pagesGrid').innerHTML = '';
   536â†’            document.getElementById('messageContainer').innerHTML = '';
   537â†’            fileInput.value = '';
   538â†’            console.log('App reset');
   539â†’        }
   540â†’    </script>
   541â†’</body>
   542â†’</html>
   543â†’

</body>
</html>
